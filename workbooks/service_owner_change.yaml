---
version: '2.0'

name: service_owner_change
description: Workbook that contains the operations done when a project changes owner

workflows:
  init:
    type: direct
    input:
      - id
      - old_owner
      - new_owner

    tasks:
      mistral:
        workflow: mistral
        input:
          id: <% $.id %>
          old_owner: <% $.old_owner %>
          new_owner: <% $.new_owner %>
        on-success:
          - nova

      magnum:
        workflow: magnum
        input:
          id: <% $.id %>
          old_owner: <% $.old_owner %>
          new_owner: <% $.new_owner %>
        on-success:
          - heat
          - barbican

      barbican:
        workflow: barbican
        input:
          id: <% $.id %>
          old_owner: <% $.old_owner %>
          new_owner: <% $.new_owner %>
        on-success:
          - nova

      heat:
        workflow: heat
        input:
          id: <% $.id %>
          old_owner: <% $.old_owner %>
          new_owner: <% $.new_owner %>
        on-success:
          - nova

      nova:
        join: all
        workflow: nova
        input:
          id: <% $.id %>
          old_owner: <% $.old_owner %>
          new_owner: <% $.new_owner %>
        on-success:
          - cinder
          - manila
          - neutron

      cinder:
        workflow: cinder
        input:
          id: <% $.id %>
          old_owner: <% $.old_owner %>
          new_owner: <% $.new_owner %>


      glance:
        workflow: glance
        input:
          id: <% $.id %>
          old_owner: <% $.old_owner %>
          new_owner: <% $.new_owner %>

      manila:
        workflow: manila
        input:
          id: <% $.id %>
          old_owner: <% $.old_owner %>
          new_owner: <% $.new_owner %>

      neutron:
        workflow: neutron
        input:
          id: <% $.id %>
          old_owner: <% $.old_owner %>
          new_owner: <% $.new_owner %>


  nova:
    description: Changes the ownership of resources of a project on the compute service
    type: direct
    input:
      - id
      - old_owner
      - new_owner
    tasks:
      empty_task:
        action: std.noop

  cinder:
    description: Changes the ownership of resources of a project on the block storage service
    type: direct
    input:
      - id
      - old_owner
      - new_owner
    tasks:
      empty_task:
        action: std.noop

  glance:
    description: Changes the ownership of resources of a project on the image service
    type: direct
    input:
      - id
      - old_owner
      - new_owner
    tasks:
      empty_task:
        action: std.noop

  manila:
    description: Changes the ownership of resources of a project on the fileshare service
    type: direct
    input:
      - id
      - old_owner
      - new_owner
    tasks:
      empty_task:
        action: std.noop

  heat:
    description: Changes the ownership of resources of a project on the orchestration service
    type: direct
    input:
      - id
      - old_owner
      - new_owner
    tasks:
      empty_task:
        action: std.noop

  barbican:
    description: Changes the ownership of resources of a project on the key_manager service
    type: direct
    input:
      - id
      - old_owner
      - new_owner
    tasks:
      empty_task:
        action: std.noop

  neutron:
    description: Changes the ownership of resources of a project on the network service
    type: direct
    input:
      - id
      - old_owner
      - new_owner
    tasks:
      empty_task:
        action: std.noop

  magnum:
    description: Changes the ownership of resources of a project on the container infrastructure service
    type: direct
    input:
      - id
      - old_owner
      - new_owner
    tasks:
      empty_task:
        action: std.noop

  mistral:
    description: Changes the ownership of resources of a project on the workflow service
    type: direct
    input:
      - id
      - old_owner
      - new_owner
    tasks:
      empty_task:
        action: std.noop
